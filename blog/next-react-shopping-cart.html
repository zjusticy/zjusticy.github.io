<!DOCTYPE html><html><head><link rel="icon" type="image/png" href="/favicon.png"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-164183122-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-164183122-1', {
              page_path: window.location.pathname,
            });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap"/><title>A shopping cart project using Nextjs and React Hook for e-commerce</title><meta name="description" content="A simple and elegant shopping cart component that can be easily integrated in e-commerce project, using Nextjs, Hook and Typescript"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/247593301584cfcb2949.css" as="style"/><link rel="stylesheet" href="/_next/static/css/247593301584cfcb2949.css"/><link rel="preload" href="/_next/static/css/f26d4875aca2643082fa.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f26d4875aca2643082fa.css"/><link rel="preload" href="/_next/static/OyX9zXWnaKsF3bwITkPiy/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/OyX9zXWnaKsF3bwITkPiy/pages/blog/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.126679bf45d7d49475d8.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.034e57c59893763d3595.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-d7ebbd1d8dc934d86683.js" as="script"/><link rel="preload" href="/_next/static/chunks/cb1608f2.3c307e8bab2014a7f3fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/b5f2ed29.a17aa8175ac69602f508.js" as="script"/><link rel="preload" href="/_next/static/chunks/02a29bc1c6847a2903810fa698c0853380643ebd.eb7f86bcbbf58571f3fc.js" as="script"/><link rel="preload" href="/_next/static/chunks/411cb42639decf701111c98274b23dedc6e87d14.7504d1c9a7d74be7afa0.js" as="script"/></head><body><div id="__next"><div><nav class="navbar has-shadow" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item" href="/"><svg width="36" height="36" viewBox="0 0 144 142" aria-hidden="true" fill="#000" class="svg-icon " xmlns="http://www.w3.org/2000/svg"><rect x="124" y="81" width="20" height="20" fill="black"></rect><rect x="124" y="102" width="20" height="20" fill="black"></rect><rect x="41" y="20" width="20" height="20" fill="black"></rect><rect x="83" y="20" width="20" height="20" fill="black"></rect><rect x="62" y="122" width="20" height="20" fill="black"></rect><rect x="124" y="60" width="20" height="20" fill="black"></rect><rect y="81" width="20" height="20" fill="black"></rect><rect y="102" width="20" height="20" fill="black"></rect><rect x="62" width="20" height="20" fill="black"></rect><rect x="41" y="122" width="20" height="20" fill="black"></rect><rect x="104" y="122" width="20" height="20" fill="black"></rect><rect x="104" y="40" width="20" height="20" fill="black"></rect><rect x="83" y="122" width="20" height="20" fill="black"></rect><rect x="20" y="40" width="20" height="20" fill="black"></rect><rect x="20" y="122" width="20" height="20" fill="black"></rect><rect y="60" width="20" height="20" fill="black"></rect></svg></a><a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample"><span aria-hidden="true"></span><span aria-hidden="true"></span><span aria-hidden="true"></span></a></div><div id="navbarBasicExample" class="navbar-menu"><div class="layout_navEndSettings__227S4 navbar-end"><a class="navbar-item layout_moreMargin__2KGfE" aria-label="Home page" href="/">Home</a><a class="navbar-item layout_moreMargin__2KGfE layout_addBorder__2Y_EI" aria-label="Blog page" href="/blog">Blog</a><a class="navbar-item layout_moreMargin__2KGfE" aria-label="About the author" href="/about">About</a></div></div></div></nav><main><div class="isBlog"><nav class="breadcrumb is-medium" aria-label="breadcrumbs"><ul><li><a href="/blog">Blog</a></li><li class="is-active"><span></span></li></ul></nav><article><h1 class="title is-2p5">A shopping cart project using Nextjs and React Hook for e-commerce</h1><span class="dateStyle-2">2 Oct, 2020</span><div class="content"><div><p><strong><a href="https://next-shopping-cart.vercel.app">DEMO</a></strong></p>
<p>This project is based on <a href="https://github.com/sivadass/react-shopping-cart">react-shopping-cart</a>, which is a web shopping cart using react and sass. However, in this fast-chaning world, this react-shopping cart is outdated. We will refactore this project using Nextjs, react hook and typescript.</p>
<p>You can check the code of this project on <a href="https://github.com/zjusticy/next-shopping-cart">Github</a>.</p>
<p><img src="/next-react-shopping-cart.gif" alt=""/></p>
<h2>Next.js</h2>
<p>Next.js is a lightweight React server-side rendering application framework. With it, we can simply and easily implement React server-side rendering, thus speeding up the first screen, and also doing SEO. Now Next.js is more powerful that can combine server-side rendering (SSR) and static site generation (SSG) to provide a more fluid experience. You can check more about Next.js <a href="https://nextjs.org/docs/getting-started">here</a>.</p>
<p>Since we only have one single page, the file structure for page folder:</p>
<pre class="language-bash"><code class="language-bash">project 
├── index.tsx 
└── _app.tsx <span class="token comment"># add head section </span>
</code></pre>
<p>We also use SSG to get a better performance. Also, Because static site does not rely on Web Server, deployment is just to put the generated web page on the CDN. Data are fetched by build in function &quot;getStaticProps“.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> getStaticProps<span class="token operator">:</span> <span class="token function-variable function"><span class="token maybe-class-name">GetStaticProps</span></span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span>
    <span class="token string">&quot;https://res.cloudinary.com/sivadass/raw/upload/v1535817394/json/products.json&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow">await</span> res<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> props<span class="token operator">:</span> <span class="token punctuation">{</span> products<span class="token operator">:</span> data <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Its time to first byte (TTFB) performance is the best.</p>
<h2>Hook</h2>
<p>Hook is a new feature of React 16.8. It allows you to use state and other React features without writing a class. Comparing to higher order component, it can be more elegant and efficient.</p>
<p>Below we have a state <code>isAdded</code> to indicate a product has successfully added to the cart.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  isAdded<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Change to the hook:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>isAdded<span class="token punctuation">,</span> setAddState<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Moreover, we can customise our own hooks. Below is some code from the original project to determine the position of the click:</p>
<pre class="language-js"><code class="language-js"><span class="token function">handleClickOutside</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cartNode <span class="token operator">=</span> <span class="token function">findDOMNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">refs</span><span class="token punctuation">.</span><span class="token property-access">cartPreview</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonNode <span class="token operator">=</span> <span class="token function">findDOMNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">refs</span><span class="token punctuation">.</span><span class="token property-access">cartButton</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>cartNode<span class="token punctuation">.</span><span class="token property-access">classList</span><span class="token punctuation">.</span><span class="token method function property-access">contains</span><span class="token punctuation">(</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cartNode <span class="token operator">||</span> <span class="token operator">!</span>cartNode<span class="token punctuation">.</span><span class="token method function property-access">contains</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        showCart<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      event<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span>
    <span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleClickOutside</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token boolean">true</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span>
    <span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleClickOutside</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token boolean">true</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To make the code more reusable, we implement the same function by hook:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> useClickOutside <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token function-variable function">closeModel</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  ref<span class="token operator">:</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">RefObject</span></span><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLDivElement</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token comment">// whether to check if the component active or not</span>
  activeCheck<span class="token operator">:</span> boolean
<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span>  <span class="token function-variable function">handleClickOutside</span>  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span>  <span class="token maybe-class-name">MouseEvent</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>ref <span class="token operator">&amp;&amp;</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>activeCheck<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">closeModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// add when mounted</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handleClickOutside<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// return function to be called when unmounted</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handleClickOutside<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> useClickOutside<span class="token punctuation">;</span>
</code></pre>
<p>We also put some states: <code>cart</code>, <code>totalItems</code> and <code>totalAmount</code> to the context which enable a more organized global state management. After this, we can use <code>useContext</code> hook inside the pages or components to introduce the needed state or function.</p>
<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    cart<span class="token punctuation">,</span>
    totalItems<span class="token punctuation">,</span>
    totalAmount<span class="token punctuation">,</span>
    removeProduct<span class="token punctuation">,</span>
    bounce<span class="token punctuation">,</span>
    bouceEnd<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> useContext<span class="token operator">&lt;</span><span class="token maybe-class-name">Init</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token maybe-class-name">CartContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2>Typescript</h2>
<p><a href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html">Typescript</a>  is a strongly typed version of JavaScript. Then the type and unique syntax are removed during the compile time to generate pure JavaScript code. Since it is still JavaScript running in the browser in the end, TypeScript does not depend on the support of the browser, nor does it cause compatibility issues.</p>
<p>TypeScript increases the readability and maintainability of the code.</p>
<h2>Height fixed when the image is not loaded</h2>
<p>The width of some pictures is determined, and the height is adaptive. When the picture is not loaded, the height is 0. After the loading is completed, its height is stretched, which will cause the page to flicker and jitter during this process. But there is no way to control the height. If the width and height of the picture are inconsistent, and the width setting is the same, the height will be uneven.</p>
<p>At this time, you can use padding to control the height of the picture, so that the pictures in the list are forced to set the same height. Take the setting on Amazon as an example. The height of the img-box is opened with padding-top/padding-bottom.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector"><span class="token class">.img-box</span></span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
      <span class="token property">padding-top</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector"><span class="token class">.img</span></span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
      <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>
      <span class="token property">max-height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#x27;</span>img<span class="token punctuation">&#x27;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./images/melon.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

</code></pre>
<p>The result is illustrated by the image below. Although the three images of pan have different heights, they all have the image boxes that have the same height and width. The image itself is centered by setting the margin to auto.</p>
<p><img src="/amazonPic.png" alt="Settings on Amazon website"/></p>
<h2>Reference</h2>
<p><a href="https://github.com/sivadass/react-shopping-cart">react-shopping-cart</a></p></div></div></article><div class="marginTop-2"><a>← Blog</a></div></div></main><footer class="layout_myFooter__JubIR container"><div class="layout_footerStyle__2iYeS"><div><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg>  <a href="mailto:tzhu618@gmail.com">tzhu618@gmail.com</a></div><div class="layout_lastColor__ALfcM">© <!-- -->2021<!-- -->, Built with<!-- --> <a href="https://nextjs.org/">NextJs</a> and <a href="https://bulma.io">Bulma</a></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"A shopping cart project using Nextjs and React Hook for e-commerce","date":"2020-08-2T21:20:16.173Z","description":"A simple and elegant shopping cart component that can be easily integrated in e-commerce project, using Nextjs, Hook and Typescript","slug":"next-react-shopping-cart","content":"\n**[DEMO](https://next-shopping-cart.vercel.app)**\n\nThis project is based on [react-shopping-cart](https://github.com/sivadass/react-shopping-cart), which is a web shopping cart using react and sass. However, in this fast-chaning world, this react-shopping cart is outdated. We will refactore this project using Nextjs, react hook and typescript.\n\nYou can check the code of this project on [Github](https://github.com/zjusticy/next-shopping-cart).\n\n![](/next-react-shopping-cart.gif)\n\n## Next.js\n\nNext.js is a lightweight React server-side rendering application framework. With it, we can simply and easily implement React server-side rendering, thus speeding up the first screen, and also doing SEO. Now Next.js is more powerful that can combine server-side rendering (SSR) and static site generation (SSG) to provide a more fluid experience. You can check more about Next.js [here](https://nextjs.org/docs/getting-started).\n\nSince we only have one single page, the file structure for page folder:\n\n```bash\nproject \n├── index.tsx \n└── _app.tsx # add head section \n```\n\nWe also use SSG to get a better performance. Also, Because static site does not rely on Web Server, deployment is just to put the generated web page on the CDN. Data are fetched by build in function \"getStaticProps“. \n\n```js\nexport const getStaticProps: GetStaticProps = async () =\u003e {\n  const url =\n    \"https://res.cloudinary.com/sivadass/raw/upload/v1535817394/json/products.json\";\n  const res = await axios.get(url);\n\n  const data = await res.data;\n\n  return { props: { products: data } };\n};\n```\n\nIts time to first byte (TTFB) performance is the best.\n\n## Hook\n\nHook is a new feature of React 16.8. It allows you to use state and other React features without writing a class. Comparing to higher order component, it can be more elegant and efficient.\n\nBelow we have a state `isAdded` to indicate a product has successfully added to the cart.\n\n```js\nthis.state = {\n  isAdded: false\n};\n```\n\nChange to the hook:\n\n```js\nconst [isAdded, setAddState] = useState\u003cboolean\u003e(false);\n```\n\nMoreover, we can customise our own hooks. Below is some code from the original project to determine the position of the click:\n\n```js\nhandleClickOutside(event) {\n  const cartNode = findDOMNode(this.refs.cartPreview);\n  const buttonNode = findDOMNode(this.refs.cartButton);\n  if (cartNode.classList.contains(\"active\")) {\n    if (!cartNode || !cartNode.contains(event.target)) {\n      this.setState({\n        showCart: false\n      });\n      event.stopPropagation();\n    }\n  }\n}\ncomponentDidMount() {\n  document.addEventListener(\n    \"click\",\n    this.handleClickOutside.bind(this),\n    true\n  );\n}\ncomponentWillUnmount() {\n  document.removeEventListener(\n    \"click\",\n    this.handleClickOutside.bind(this),\n    true\n  );\n}\n```\n\nTo make the code more reusable, we implement the same function by hook:\n\n```js\nimport { useEffect } from \"react\";\n\nconst useClickOutside = (\n  closeModel: () =\u003e void,\n  ref: React.RefObject\u003cHTMLDivElement\u003e,\n  // whether to check if the component active or not\n  activeCheck: boolean\n) =\u003e {\n  const  handleClickOutside  = (e:  MouseEvent) =\u003e {\n\n  if (ref \u0026\u0026 ref.current \u0026\u0026 !ref.current.contains(e.target as Element)) {\n    if (activeCheck) {\n      e.stopPropagation();\n    }\n    closeModel();\n  }\n};\n\n  useEffect(() =\u003e {\n    // add when mounted\n    document.addEventListener(\"click\", handleClickOutside, true);\n    // return function to be called when unmounted\n    return () =\u003e {\n      document.removeEventListener(\"click\", handleClickOutside, true);\n    };\n  }, []);\n};\n\nexport default useClickOutside;\n```\n\nWe also put some states: `cart`, `totalItems` and `totalAmount` to the context which enable a more organized global state management. After this, we can use `useContext` hook inside the pages or components to introduce the needed state or function.\n\n```js\n  const {\n    cart,\n    totalItems,\n    totalAmount,\n    removeProduct,\n    bounce,\n    bouceEnd,\n  } = useContext\u003cInit\u003e(CartContext);\n```\n\n## Typescript\n\n[Typescript](https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html)  is a strongly typed version of JavaScript. Then the type and unique syntax are removed during the compile time to generate pure JavaScript code. Since it is still JavaScript running in the browser in the end, TypeScript does not depend on the support of the browser, nor does it cause compatibility issues.\n\nTypeScript increases the readability and maintainability of the code.\n\n\n## Height fixed when the image is not loaded\n\nThe width of some pictures is determined, and the height is adaptive. When the picture is not loaded, the height is 0. After the loading is completed, its height is stretched, which will cause the page to flicker and jitter during this process. But there is no way to control the height. If the width and height of the picture are inconsistent, and the width setting is the same, the height will be uneven.\n\nAt this time, you can use padding to control the height of the picture, so that the pictures in the list are forced to set the same height. Take the setting on Amazon as an example. The height of the img-box is opened with padding-top/padding-bottom.\n\n```html\n\u003chead\u003e\n  \u003cstyle\u003e\n    .img-box {\n      position: relative;\n      padding-top: 100%;\n    }\n\n    .img {\n      position: absolute;\n      margin: auto;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      max-width: 100%;\n      max-height: 100%;\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\n\u003cdiv class=\"img-box\"\u003e\n  \u003cimg class='img' src=\"./images/melon.png\" alt=\"\"\u003e\n\u003c/div\u003e\n\n```\n\nThe result is illustrated by the image below. Although the three images of pan have different heights, they all have the image boxes that have the same height and width. The image itself is centered by setting the margin to auto.\n\n![Settings on Amazon website](/amazonPic.png)\n\n\n## Reference\n\n[react-shopping-cart](https://github.com/sivadass/react-shopping-cart) \n\n\n\n\n\n\n\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"next-react-shopping-cart"},"buildId":"OyX9zXWnaKsF3bwITkPiy","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-81f5c03661bad3d2f6ee.js"></script><script async="" data-next-page="/_app" src="/_next/static/OyX9zXWnaKsF3bwITkPiy/pages/_app.js"></script><script async="" data-next-page="/blog/[slug]" src="/_next/static/OyX9zXWnaKsF3bwITkPiy/pages/blog/%5Bslug%5D.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.126679bf45d7d49475d8.js" async=""></script><script src="/_next/static/chunks/commons.034e57c59893763d3595.js" async=""></script><script src="/_next/static/runtime/main-d7ebbd1d8dc934d86683.js" async=""></script><script src="/_next/static/chunks/cb1608f2.3c307e8bab2014a7f3fb.js" async=""></script><script src="/_next/static/chunks/b5f2ed29.a17aa8175ac69602f508.js" async=""></script><script src="/_next/static/chunks/02a29bc1c6847a2903810fa698c0853380643ebd.eb7f86bcbbf58571f3fc.js" async=""></script><script src="/_next/static/chunks/411cb42639decf701111c98274b23dedc6e87d14.7504d1c9a7d74be7afa0.js" async=""></script><script src="/_next/static/OyX9zXWnaKsF3bwITkPiy/_buildManifest.js" async=""></script><script src="/_next/static/OyX9zXWnaKsF3bwITkPiy/_ssgManifest.js" async=""></script></body></html>